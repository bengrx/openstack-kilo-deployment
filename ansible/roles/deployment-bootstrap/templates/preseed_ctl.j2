d-i debian-installer/locale string en_GB
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/layoutcode string gb
d-i netcfg/choose_interface select auto

d-i netcfg/get_hostname string unassigned-hostname
d-i netcfg/get_domain string unassigned-domain
d-i netcfg/get_hostname see true
d-i netcfg/get_domain seen true

d-i netcfg/wireless_wep string
d-i hw-detect/load_firmware boolean true
d-i mirror/country string manual
d-i mirror/http/hostname string archive.ubuntu.com
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string
d-i passwd/username string {{ deployment_user }}
d-i passwd/user-fullname string {{ deployment_user }}
d-i passwd/user-password password {{ deployment_user }}
d-i passwd/user-password-again password {{ deployment_user }}
d-i user-setup/encrypt-home boolean false
d-i time/zone string GB/London
d-i clock-setup/utc boolean false
d-i clock-setup/ntp boolean true
d-i clock-setup/ntp-server string 0.uk.pool.ntp.org
d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string regular
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-lvm/confirm boolean true
#d-i partman-auto/choose_recipe select atomic
d-i partman-auto/expert_recipe string                         \
      boot-root ::                                            \
              40 1024 1024 ext4                               \
                      $primary{ } $bootable{ }                \
                      method{ format } format{ }              \
                      use_filesystem{ } filesystem{ ext3 }    \
                      mountpoint{ /boot }                     \
              .                                               \
              500 10000 1000000000 ext4                       \
                      method{ format } format{ }              \
                      use_filesystem{ } filesystem{ ext3 }    \
                      mountpoint{ / }                         \
              .                                               \
              64 4096 8192 linux-swap                         \
                      method{ swap } format{ }                \
              . 
d-i partman-md/confirm boolean true
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
d-i apt-setup/services-select multiselect security
d-i apt-setup/security_host string security.ubuntu.com
d-i apt-setup/security_path string /ubuntu
tasksel tasksel/first multiselect ubuntu-minimal
d-i pkgsel/include string openssh-server build-essential gcc make puppet python-dev python-pip wget curl
d-i pkgsel/upgrade select safe-upgrade
d-i time/zone string Europe/London
d-i pkgsel/update-policy select none
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true
d-i grub-installer/timeout string 2
d-i finish-install/reboot_in_progress note
d-i debian-installer/exit/reboot boolean true

d-i preseed/late_command string \
    in-target sed -i 's/^%sudo.*$/%sudo ALL=(ALL:ALL) NOPASSWD: ALL/g' /etc/sudoers; \
    in-target mkdir -p /home/{{ deployment_user }}/.ssh; \
    in-target wget http://{{ boot_interface_address }}/authorized_keys -O /tmp/authorized_keys; \
    in-target /bin/sh -c "cat /tmp/authorized_keys>/home/{{ deployment_user }}/.ssh/authorized_keys"; \
    in-target rm -f /tmp/authorized_keys; \
    in-target wget http://{{ boot_interface_address }}/hostnames -O /tmp/hosts; \
    in-target /bin/sh -c "cat /tmp/hosts>/etc/hosts"; \
    in-target rm -f /tmp/hosts; \
    in-target chown -R {{ deployment_user }}:{{ deployment_user }} /home/{{ deployment_user }}/; \
    in-target chmod -R go-rwx /home/{{ deployment_user }}/authorized_keys; \
    in-target sed -i 's/PermitRootLogin yes/PermitRootLogin no/g' /etc/ssh/sshd_config; \
    in-target sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/g' /etc/ssh/sshd_config; \
    in-target rm /etc/udev/rules.d/70-persistent-net.rules; \
    in-target aptitude clean; \
